---
import { getCollection } from 'astro:content';
// 这里是关键！从 pages/writing/ 退回两层才能找到 components
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

const posts = await getCollection('essays', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const pageTitle = "nemu · essays";
---

<html lang="en">
  <head>
    <BaseHead title={pageTitle} description="Archive" />
    <style>
      /* 这里的 CSS 保持你原本华丽的哥特风，完全不改动 */
      .wrap { max-width: 1100px; margin: 0 auto; padding: 68px 20px; }
      .hero { position: relative; padding: 16px 0 34px; margin-bottom: 22px; }
      .hero::before { content: "✠"; position: absolute; left: 0; top: -6px; font-size: 22px; color: rgba(214,178,94,.75); }
      .hero h1 { margin: 0; font-family: var(--font-display); font-size: clamp(44px, 6vw, 64px); }
      .divider { margin-top: 18px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 14px; }
      .divider .line { height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent); }
      .divider .gem { width: 10px; height: 10px; transform: rotate(45deg); background: radial-gradient(circle at 30% 30%, #fff, #d6b25e); border: 1px solid #d6b25e; border-radius: 2px; }
      .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; margin-top: 30px; }
      .card { position: relative; border-radius: 22px; background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.14); padding: 40px; transition: 0.2s; }
      .card:hover { border-color: rgba(214,178,94,.55); transform: translateY(-2px); }
    </style>
  </head>
  <body>
    <Header />
    <main class="wrap">
      <section class="hero">
        <h1>Essays</h1>
        <div class="divider"><div class="line"></div><div class="gem"></div><div class="line"></div></div>
      </section>
      <div class="grid">
        {sortedPosts.map((post) => (
          <a href={`/writing/essays/${post.id}/`} style="text-decoration: none; color: inherit;">
            <article class="card">
              <div style="font-family: var(--font-display); font-size: 24px; color: #d6b25e;">{post.data.title}</div>
              <p style="opacity: 0.7;">{post.data.description}</p>
            </article>
          </a>
        ))}
      </div>
    </main>
    <Footer />
  </body>
</html>
