---
import { getCollection, render } from 'astro:content';
import BaseHead from '@/components/BaseHead.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

export async function getStaticPaths() {
	const posts = await getCollection('essays');
	return posts.map((post) => ({ params: { slug: post.id }, props: post }));
}
const post = Astro.props;
const { Content } = await render(post);
---
<html lang="en">
	<head>
		<BaseHead title={post.data.title} description={post.data.description} />
		<style>
			#progress-bar { position: fixed; top: 0; left: 0; width: 0%; height: 2px; background: var(--accent-gold); z-index: 10000; }
			main { max-width: 750px; margin: 0 auto; padding: 80px 20px; }
			.title { text-align: center; margin-bottom: 4em; }
			.title h1 { font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--ivory); }
			.prose { font-family: 'EB Garamond', serif; font-size: 1.25rem; line-height: 1.8; color: rgba(255,255,255,0.85); }

			/* --- 解决重叠问题的首字下沉 --- */
			.prose :global(p:first-of-type::first-letter) {
				float: left;
				font-family: 'Cinzel', serif;
				font-size: 4.2rem; /* 稍微缩小 */
				line-height: 0.7;  /* 极其关键：大幅度降低行高 */
				margin: 0.15em 0.12em 0 0; /* 增加右侧间距 */
				color: var(--accent-gold);
				-webkit-text-stroke: 1px rgba(255,255,255,0.1);
			}

			/* --- 引文效果修正 --- */
			.prose :global(blockquote) {
				margin: 3em 0;
				padding: 1.5em 2em;
				border-left: 2px solid var(--accent-gold);
				background: rgba(214, 178, 94, 0.03);
				font-style: italic;
				color: var(--accent-gold);
			}
		</style>
	</head>
	<body>
		<div id="progress-bar"></div>
		<Header />
		<main>
			<article>
				<div class="title"><h1>{post.data.title}</h1></div>
				<div class="prose"><Content /></div>
			</article>
		</main>
		<script>
			window.onscroll = function() {
				const winScroll = document.documentElement.scrollTop;
				const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
				const scrolled = (winScroll / height) * 100;
				const bar = document.getElementById("progress-bar");
				if (bar) bar.style.width = scrolled + "%";
			};
		</script>
		<Footer />
	</body>
</html>
