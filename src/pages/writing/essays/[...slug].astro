---
import { getCollection, render } from 'astro:content';
import BaseHead from '@/components/BaseHead.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

export async function getStaticPaths() {
	const posts = await getCollection('essays');
	return posts.map((post) => ({ params: { slug: post.id }, props: post }));
}
const post = Astro.props;
const { Content } = await render(post);
---
<html lang="en">
	<head>
		<BaseHead title={post.data.title} description={post.data.description} />
		<style>
			/* 顶部金色进度条 */
			#progress-bar { 
				position: fixed; 
				top: 0; left: 0; 
				width: 0%; height: 2px; 
				background: var(--accent-gold); 
				z-index: 10000; 
			}

			main { 
				max-width: 700px; 
				margin: 0 auto; 
				padding: 80px 24px; 
			}

			.title { 
				text-align: center; 
				margin-bottom: 5em; 
			}

			.title h1 { 
				font-family: 'Cinzel', serif; 
				font-size: clamp(1.8rem, 5vw, 2.4rem); 
				color: var(--ivory); 
				letter-spacing: 0.1em;
				line-height: 1.3;
			}

			/* 文章主体排版 */
			.prose { 
				font-family: 'EB Garamond', serif; 
				font-size: 1.25rem; 
				line-height: 1.85; 
				color: rgba(255, 255, 255, 0.85); 
			}

			/* --- 修正版：内敛首字强调 (不再夸张) --- */
			.prose :global(p:first-of-type::first-letter) {
				font-family: 'Cinzel', serif;
				font-size: 1.8rem;    /* 仅比正文大一点，保持安静 */
				font-weight: 700;
				color: var(--accent-gold);
				margin-right: 0.1em;
				float: none;          /* 彻底取消浮动，绝不重叠 */
				vertical-align: baseline;
			}

			/* --- 修正版：素雅引文 (Blockquote) --- */
			.prose :global(blockquote) {
				margin: 3em 0;
				padding: 0.5em 1.5em;
				border-left: 1px solid rgba(214, 178, 94, 0.4); /* 细线质感 */
				background: transparent; /* 移除背景色，更通透 */
				font-style: italic;
				color: rgba(214, 178, 94, 0.7); /* 调低亮度，像低语 */
			}

			.prose :global(blockquote p) {
				margin: 0;
				line-height: 1.6;
			}

			/* 段落间距 */
			.prose :global(p) {
				margin-bottom: 1.5em;
			}

			/* 手机端细节微调 */
			@media (max-width: 720px) {
				main { padding: 60px 20px; }
				.title { margin-bottom: 3em; }
				.prose { font-size: 1.15rem; }
			}
		</style>
	</head>
	<body>
		<div id="progress-bar"></div>
		<Header />
		<main>
			<article>
				<div class="title">
					<h1>{post.data.title}</h1>
				</div>
				<div class="prose">
					<Content />
				</div>
			</article>
		</main>
		<script>
			// 进度条逻辑
			const updateProgress = () => {
				const winScroll = document.documentElement.scrollTop;
				const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
				const scrolled = (winScroll / height) * 100;
				const bar = document.getElementById("progress-bar");
				if (bar) bar.style.width = scrolled + "%";
			};
			window.addEventListener('scroll', updateProgress);
		</script>
		<Footer />
	</body>
</html>
