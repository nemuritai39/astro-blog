---
import { getCollection, render } from 'astro:content';
import BaseHead from '@/components/BaseHead.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

export async function getStaticPaths() {
	const posts = await getCollection('essays');
	return posts.map((post) => ({ params: { slug: post.id }, props: post }));
}
const post = Astro.props;
const { Content } = await render(post);
---
<html lang="en">
	<head>
		<BaseHead title={post.data.title} description={post.data.description} />
		<style>
			/* 顶部进度条 */
			#progress-bar {
				position: fixed;
				top: 0; left: 0; width: 0%; height: 2px;
				background: var(--accent-gold);
				z-index: 10000;
				transition: width 0.1s ease;
			}
			main { max-width: 750px; margin: 0 auto; padding: 100px 20px; }
			.title { text-align: center; margin-bottom: 4em; }
			.title h1 { font-family: 'Cinzel', serif; font-size: 3rem; color: var(--ivory); }
			
			.prose { font-family: 'EB Garamond', serif; font-size: 1.3rem; line-height: 1.8; color: rgba(255,255,255,0.8); }
			
			/* 终极首字下沉 */
			.prose :global(p:first-of-type::first-letter) {
				float: left;
				font-family: 'Cinzel', serif;
				font-size: 4.5rem;
				line-height: 1;
				margin: 0.1em 0.1em 0 0;
				color: var(--accent-gold);
				-webkit-text-stroke: 1px rgba(255,255,255,0.1);
			}
		</style>
	</head>
	<body>
		<div id="progress-bar"></div>
		<Header />
		<main>
			<article>
				<div class="title"><h1>{post.data.title}</h1></div>
				<div class="prose"><Content /></div>
			</article>
		</main>
		<script>
			window.onscroll = function() {
				const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
				const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
				const scrolled = (winScroll / height) * 100;
				const bar = document.getElementById("progress-bar");
				if (bar) bar.style.width = scrolled + "%";
			};
		</script>
		<Footer />
	</body>
</html>
