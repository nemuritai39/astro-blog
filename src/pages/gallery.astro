---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE } from '../consts';

const photos = (await getCollection('gallery')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Gallery - ${SITE_TITLE}`} description="摄影集" />
		<style>
			main { max-width: 1400px; margin: 0 auto; padding: 140px 24px; }
			.gallery-container { display: grid; grid-template-columns: repeat(12, 1fr); gap: 120px 30px; }
			.photo-card { grid-column: span 12; position: relative; cursor: zoom-in; }
			@media (min-width: 1024px) {
				.photo-card:nth-child(4n+1) { grid-column: 2 / span 4; } 
				.photo-card:nth-child(4n+2) { grid-column: 7 / span 5; margin-top: 150px; }
				.photo-card:nth-child(4n+3) { grid-column: 1 / span 5; }
				.photo-card:nth-child(4n+4) { grid-column: 7 / span 4; margin-top: -80px; }
			}
			.image-wrapper { overflow: hidden; background: #0a0a0a; }
			.photo-card img { width: 100%; height: auto; display: block; filter: grayscale(20%); transition: 1.5s cubic-bezier(0.16, 1, 0.3, 1); }
			.photo-card:hover img { filter: grayscale(0%); transform: scale(1.02); }
			.photo-meta { margin-top: 1.2rem; font-family: 'Cinzel', serif; font-size: 0.7rem; letter-spacing: 0.4em; opacity: 0.6; }
			#lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; visibility: hidden; transition: 0.5s; cursor: zoom-out; }
			#lightbox.active { opacity: 1; visibility: visible; }
			#lightbox img { max-width: 90vw; max-height: 85vh; object-fit: contain; }
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="gallery-container">
				{photos.map((photo) => (
					<div class="photo-card" data-src={photo.data.cover}>
						<div class="image-wrapper"><img src={photo.data.cover} alt={photo.data.title} /></div>
						<div class="photo-meta"><h3>{photo.data.title}</h3></div>
					</div>
				))}
			</div>
		</main>
		<div id="lightbox"><img src="" /></div>
		<Footer />
		<script>
			const lb = document.getElementById('lightbox');
			const lbImg = lb?.querySelector('img');
			document.querySelectorAll('.photo-card').forEach(card => {
				card.addEventListener('click', () => {
					const src = card.getAttribute('data-src');
					if (src && lbImg) { lbImg.src = src; lb.classList.add('active'); }
				});
			});
			lb?.addEventListener('click', () => lb.classList.remove('active'));
		</script>
	</body>
</html>
