---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from 'astro:content';

// 获取 gallery 集合中的所有非草稿内容
const entries = await getCollection('gallery', ({ data }) => {
  return data.draft !== true;
});

// 按发布日期排序
const photos = entries.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const pageTitle = "nemu · gallery";
const heading = "Gallery";
const description = "照片与视频（第一版先做精简展示）。";

const videos = [
  { title: "Video link 1", href: "#" },
  { title: "Video link 2", href: "#" },
];
---

<html lang="en">
  <head>
    <BaseHead title={pageTitle} description={description} />
    <style>
      .wrap { max-width: 1100px; margin: 0 auto; padding: 68px 20px; }
      .hero { position: relative; padding: 16px 0 34px; margin-bottom: 22px; }
      .hero::before {
        content: "✠"; position: absolute; left: 0; top: -6px;
        font-size: 22px; color: rgba(214,178,94,.75);
        filter: drop-shadow(0 0 14px rgba(214,178,94,.20));
      }
      .hero h1 {
        margin: 0; font-family: var(--font-display);
        letter-spacing: .06em; font-size: clamp(44px, 6vw, 64px);
        line-height: 1.04;
      }
      .hero p { margin: 10px 0 0; opacity: .85; max-width: 62ch; }
      .divider {
        margin-top: 18px; display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center; gap: 14px; opacity: .9;
      }
      .divider .line {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);
      }
      .divider .gem {
        width: 10px; height: 10px; transform: rotate(45deg);
        background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(214,178,94,.58) 45%, rgba(120,18,30,.55) 80%);
        border: 1px solid rgba(214,178,94,.55);
        box-shadow: 0 0 0 6px rgba(120,18,30,.10), 0 12px 26px rgba(0,0,0,.55);
        border-radius: 2px;
      }
      .section { margin-top: 30px; }
      .section-head { display:flex; align-items:baseline; gap:10px; margin:0 0 14px; }
      .section-head h2 { margin:0; font-family: var(--font-display); font-size:28px; letter-spacing:.06em; }
      .section-head .tag { font-family: var(--font-mono); font-size:12px; letter-spacing:.18em; text-transform:uppercase; opacity:.65; }
      .grid { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 18px; }
      @media (max-width: 900px){ .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
      @media (max-width: 560px){ .grid { grid-template-columns: 1fr; } }
      .cardLink { text-decoration: none; color: inherit; display:block; }
      .card{
        position: relative; border-radius: 22px;
        background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
        border: 1px solid rgba(255,255,255,.14);
        box-shadow: 0 26px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.06);
        overflow: hidden; min-height: 270px;
        transform: translateY(0);
        transition: transform .18s ease, border-color .18s ease;
      }
      .stud{
        position:absolute; width:10px; height:10px; transform: rotate(45deg);
        border-radius:2px;
        background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(214,178,94,.52) 45%, rgba(120,18,30,.45) 80%);
        border: 1px solid rgba(214,178,94,.55);
      }
      .s-tl{ top:14px; left:14px; } .s-tr{ top:14px; right:14px; }
      .s-bl{ bottom:56px; left:14px; } .s-br{ bottom:56px; right:14px; }
      .ph{ position: relative; height: 230px; margin: 20px; border-radius: 18px; background: rgba(0,0,0,.22); overflow: hidden; }
      .ph img{ width:100%; height:100%; object-fit: cover; display:block; }
      .plaque{ position:absolute; left:0; right:0; bottom:0; padding:14px 18px; background: linear-gradient(180deg, transparent, rgba(0,0,0,.55)); border-top: 1px solid rgba(255,255,255,.08); }
      .plaque .t{ font-weight:600; }
    </style>
  </head>
  <body>
    <Header />
    <main class="wrap">
      <section class="hero">
        <h1>{heading}</h1>
        <p>{description}</p>
        <div class="divider"><div class="line"></div><div class="gem"></div><div class="line"></div></div>
      </section>

      <section class="section">
        <div class="section-head"><h2>Photos</h2><span class="tag">reliquary</span></div>
        <div class="grid">
          {photos.map((p) => (
            <a class="cardLink" href={`/gallery/${p.id}/`}>
              <article class="card">
                <span class="stud s-tl"></span><span class="stud s-tr"></span>
                <span class="stud s-bl"></span><span class="stud s-br"></span>
                <div class="ph">
                  {p.data.cover && <img src={p.data.cover} alt={p.data.title} />}
                </div>
                <div class="plaque">
                  <div class="t">{p.data.title}</div>
                </div>
              </article>
            </a>
          ))}
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
