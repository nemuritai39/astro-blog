---
const path = Astro.url?.pathname ?? "/";

function currentSection(p: string) {
  if (p === "/") return "HOME";
  if (p.startsWith("/writing")) return "WRITING";
  if (p.startsWith("/gallery")) return "GALLERY";
  if (p.startsWith("/with-you")) return "WITH YOU";
  return "ARCHIVE";
}

const section = currentSection(path);

const links = [
  { href: "/", label: "HOME", icon: "plus" },
  { href: "/writing", label: "WRITING", icon: "quill" },
  { href: "/gallery", label: "GALLERY", icon: "gem" },
  { href: "/with-you", label: "WITH YOU", icon: "lock" },
];

function isActive(href: string) {
  if (href === "/") return path === "/";
  return path.startsWith(href);
}
---

<header class="na-header">
  <nav class="na-nav">
    <a class="na-brand" href="/" aria-label="nemu · archive">
      <span class="na-sigil" aria-hidden="true">✠</span>
      <span class="na-brandText">nemu · archive</span>
      <span class="na-chip" aria-hidden="true">{section}</span>
    </a>

    <div class="na-links" role="navigation" aria-label="Primary">
      {links.map((l) => (
        <a class={`na-pill ${isActive(l.href) ? "is-active" : ""}`} href={l.href}>
          <span class="na-ico" aria-hidden="true">
            {l.icon === "plus" && (
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              </svg>
            )}
            {l.icon === "quill" && (
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none">
                <path d="M20 4c-6 1-11 6-12 12l-4 4 6-2c6-1 11-6 10-14z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M13 11l-2 2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
            )}
            {l.icon === "gem" && (
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none">
                <path d="M12 3l8 7-8 11L4 10l8-7z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M4 10h16" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" opacity=".8"/>
              </svg>
            )}
            {l.icon === "lock" && (
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none">
                <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M7 11h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
              </svg>
            )}
          </span>
          <span class="na-text">{l.label}</span>
        </a>
      ))}
    </div>
  </nav>
  <div class="na-hairline" aria-hidden="true"></div>
</header>

<style>
  .na-header{
    position: sticky;
    top: 0;
    z-index: 50;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background: linear-gradient(to bottom, rgba(10,10,12,.72), rgba(10,10,12,.45));
    border-bottom: 1px solid rgba(255,255,255,.06);
  }
  .na-nav{
    max-width: 1180px;
    margin: 0 auto;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }

  .na-brand{
    display: inline-flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: rgba(255,255,255,.92);
    letter-spacing: .06em;
  }
  .na-sigil{
    color: rgba(214,178,94,.95);
    text-shadow: 0 0 10px rgba(214,178,94,.18);
    transform: translateY(-1px);
  }
  .na-brandText{
    font-size: 14px;
    opacity: .95;
  }
  .na-chip{
    font-size: 11px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(214,178,94,.22);
    background: rgba(214,178,94,.06);
    color: rgba(214,178,94,.95);
    letter-spacing: .14em;
    text-transform: uppercase;
  }

  .na-links{
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .na-pill{
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    border-radius: 999px;
    text-decoration: none;
    color: rgba(255,255,255,.78);
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.03);
    box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
    transition: transform .12s ease, border-color .12s ease, background .12s ease, color .12s ease;
  }
  .na-pill:hover{
    transform: translateY(-1px);
    border-color: rgba(214,178,94,.34);
    background: rgba(214,178,94,.06);
    color: rgba(214,178,94,.95);
  }
  .na-pill.is-active{
    border-color: rgba(190,35,35,.45);
    background: rgba(190,35,35,.10);
    color: rgba(190,35,35,.95);
  }
  .na-ico{
    width: 16px;
    height: 16px;
    display: inline-grid;
    place-items: center;
    color: currentColor;
    opacity: .95;
  }
  .na-text{
    font-size: 12px;
    letter-spacing: .18em;
    text-transform: uppercase;
  }

  .na-hairline{
    height: 1px;
    background: linear-gradient(90deg,
      rgba(190,35,35,.0),
      rgba(190,35,35,.22),
      rgba(214,178,94,.28),
      rgba(190,35,35,.22),
      rgba(190,35,35,.0)
    );
  }

  @media (max-width: 820px){
    .na-nav{ padding: 12px 14px; }
    .na-brandText{ display: none; }
    .na-text{ letter-spacing: .12em; }
  }
  @media (max-width: 520px){
    .na-links{ gap: 8px; }
    .na-pill{ padding: 9px 12px; }
  }
</style>
