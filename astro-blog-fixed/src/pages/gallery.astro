---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

/** 不用 getCollection：直接 glob 读取 src/content/gallery 下的 md */
const modules = import.meta.glob("../content/gallery/*.md", { eager: true });

type Photo = {
  slug: string;
  title: string;
  pubDate: Date;
  cover: string;
  note?: string;
  draft?: boolean;
};

const photos: Photo[] = Object.entries(modules)
  .map(([path, mod]: any) => {
    const fm = mod.frontmatter ?? {};
    const slug = path.split("/").pop().replace(/\.md$/, "");
    return {
      slug,
      title: fm.title ?? slug,
      pubDate: fm.pubDate ? new Date(fm.pubDate) : new Date(0),
      cover: fm.cover ?? "",
      note: fm.note,
      draft: fm.draft ?? false,
    };
  })
  .filter((p) => !p.draft && p.cover)
  .sort((a, b) => b.pubDate.valueOf() - a.pubDate.valueOf());

const pageTitle = "nemu · gallery";
const heading = "Gallery";
const description = "照片与视频（第一版先做精简展示）。";

const videos = [
  { title: "Video link 1", href: "#" },
  { title: "Video link 2", href: "#" },
];
---

<html lang="en">
  <head>
    <BaseHead title={pageTitle} description={description} />
    <style>
      .wrap { max-width: 1100px; margin: 0 auto; padding: 68px 20px; }

      .hero { position: relative; padding: 16px 0 34px; margin-bottom: 22px; }
      .hero::before {
        content: "✠"; position: absolute; left: 0; top: -6px;
        font-size: 22px; color: rgba(214,178,94,.75);
        filter: drop-shadow(0 0 14px rgba(214,178,94,.20));
      }
      .hero h1 {
        margin: 0; font-family: var(--font-display);
        letter-spacing: .06em; font-size: clamp(44px, 6vw, 64px);
        line-height: 1.04;
      }
      .hero p { margin: 10px 0 0; opacity: .85; max-width: 62ch; }

      .divider {
        margin-top: 18px; display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center; gap: 14px; opacity: .9;
      }
      .divider .line {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);
      }
      .divider .gem {
        width: 10px; height: 10px; transform: rotate(45deg);
        background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(214,178,94,.58) 45%, rgba(120,18,30,.55) 80%);
        border: 1px solid rgba(214,178,94,.55);
        box-shadow: 0 0 0 6px rgba(120,18,30,.10), 0 12px 26px rgba(0,0,0,.55);
        border-radius: 2px;
      }

      .section { margin-top: 30px; }
      .section-head { display:flex; align-items:baseline; gap:10px; margin:0 0 14px; }
      .section-head h2 { margin:0; font-family: var(--font-display); font-size:28px; letter-spacing:.06em; }
      .section-head .tag { font-family: var(--font-mono); font-size:12px; letter-spacing:.18em; text-transform:uppercase; opacity:.65; }

      .grid { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 18px; }
      @media (max-width: 900px){ .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
      @media (max-width: 560px){ .grid { grid-template-columns: 1fr; } }

      .cardLink { text-decoration: none; color: inherit; display:block; }

      .card{
        position: relative; border-radius: 22px;
        background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
        border: 1px solid rgba(255,255,255,.14);
        box-shadow: 0 26px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.06);
        overflow: hidden; min-height: 270px;
        transform: translateY(0);
        transition: transform .18s ease, border-color .18s ease;
      }
      .card::before{
        content:""; position:absolute; inset:0; pointer-events:none;
        background:
          radial-gradient(420px 220px at 20% 0%, rgba(214,178,94,.08), transparent 70%),
          radial-gradient(420px 220px at 80% 0%, rgba(120,18,30,.10), transparent 70%),
          linear-gradient(180deg, rgba(255,255,255,.02), transparent);
      }
      .cardLink:hover .card{ transform: translateY(-2px); border-color: rgba(214,178,94,.55); }

      .stud{
        position:absolute; width:10px; height:10px; transform: rotate(45deg);
        border-radius:2px;
        background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(214,178,94,.52) 45%, rgba(120,18,30,.45) 80%);
        border: 1px solid rgba(214,178,94,.55);
        box-shadow: 0 0 0 5px rgba(120,18,30,.10), 0 10px 22px rgba(0,0,0,.55);
      }
      .s-tl{ top:14px; left:14px; }
      .s-tr{ top:14px; right:14px; }
      .s-bl{ bottom:56px; left:14px; }
      .s-br{ bottom:56px; right:14px; }

      .frame{
        position:absolute; inset:16px; border-radius:18px;
        border: 1px solid rgba(255,255,255,.10);
        box-shadow: inset 0 0 0 1px rgba(0,0,0,.20);
      }

      .ph{
        position: relative;
        height: 230px;
        margin: 20px;
        border-radius: 18px;
        border: 1px dashed rgba(255,255,255,.16);
        background: rgba(0,0,0,.22);
        overflow: hidden;
      }
      .ph img{
        width:100%;
        height:100%;
        object-fit: cover;
        display:block;
        opacity:.92;
      }

      .plaque{
        position:absolute; left:0; right:0; bottom:0;
        padding:14px 18px;
        background: linear-gradient(180deg, transparent, rgba(0,0,0,.55));
        border-top: 1px solid rgba(255,255,255,.08);
      }
      .plaque .t{ font-weight:600; letter-spacing:.02em; }
      .plaque .m{
        margin-top:6px; font-size:12px; opacity:.72;
        letter-spacing:.14em; text-transform:uppercase;
        display:inline-flex; align-items:center; gap:8px;
      }
      .plaque .m::before{ content:"✥"; color: rgba(214,178,94,.85); }

      .list{ display:grid; gap:12px; }
      .link{
        display:flex; align-items:center; justify-content:space-between; gap:12px;
        padding:14px 16px; border-radius:16px;
        border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.04);
        text-decoration:none; color:inherit;
        transition: border-color .18s ease, transform .18s ease;
      }
      .link:hover{ border-color: rgba(214,178,94,.55); transform: translateY(-1px); }
      .link .l{ display:inline-flex; align-items:center; gap:10px; }
      .link .l::before{ content:"✠"; color: rgba(214,178,94,.85); }
      .link .arrow{ opacity:.7; }
    </style>
  </head>

  <body>
    <Header />
    <main class="wrap">
      <section class="hero">
        <h1>{heading}</h1>
        <p>{description}</p>
        <div class="divider" aria-hidden="true">
          <div class="line" />
          <div class="gem" />
          <div class="line" />
        </div>
      </section>

      <section class="section">
        <div class="section-head">
          <h2>Photos</h2>
          <span class="tag">reliquary</span>
        </div>

        <div class="grid">
          {photos.map((p) => (
            <a class="cardLink" href={`/gallery/${p.slug}/`} aria-label={p.title}>
              <article class="card">
                <span class="stud s-tl" aria-hidden="true" />
                <span class="stud s-tr" aria-hidden="true" />
                <span class="stud s-bl" aria-hidden="true" />
                <span class="stud s-br" aria-hidden="true" />
                <span class="frame" aria-hidden="true" />

                <div class="ph">
                  <img src={p.cover} alt={p.title} loading="lazy" />
                </div>

                <div class="plaque">
                  <div class="t">{p.title}</div>
                  <div class="m">{p.note ?? "relic"}</div>
                </div>
              </article>
            </a>
          ))}
        </div>
      </section>

      <section class="section">
        <div class="section-head">
          <h2>Videos</h2>
          <span class="tag">links</span>
        </div>
        <div class="list">
          {videos.map((v) => (
            <a class="link" href={v.href}>
              <span class="l">{v.title}</span>
              <span class="arrow">→</span>
            </a>
          ))}
        </div>

        <p style="opacity:.72; margin-top:12px; max-width:70ch;">
          后面我们会把这里升级成真正的视频嵌入卡片（包含封面、日期与标签）。
        </p>
      </section>
    </main>
    <Footer />
  </body>
</html>
